## 程序

程序是指系统指令和数据的有序集合, 是一个静态的实体, 不存在运行状态的概念

进程与程序的概念:

1. 进程是程序运行所处的状态实体名称, 是一个动态概念
2. 进程包含程序, 进程的执行离不开程序

## 进程 和 线程

#### 进程

> 一句话总结关于前端部分进程的最详细描述
> 一个进程就是一个程序的运行实例, 在该程序启动的时候, 操作系统会为该程序创建一块内存空间, 用来存放指定的程序代码, 运行中的数据, 以及一个执行任务的主线程, 我们把这样的一个运行环境叫做进程

![img](https://user-gold-cdn.xitu.io/2020/7/4/1731a04a8aac678d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

从图中可以看到, 线程是依附于进程的, 而进程中使用多线程并行处理能提升运算效率

进程和线程之间的关系有以下 4 个特点:

- 进程中的任意一线程执行出错, 都会导致整个进程的崩溃

- 线程之间共享进程中的数据

  ![img](https://user-gold-cdn.xitu.io/2020/7/4/1731a060feb69e7c?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

  从上图可以看出, 线程 1、线程 2、线程 3 分别把执行的结果写入 A、B、C 中, 然后线程 2 继续从 A、B、C 中读取数据, 用来显示执行结果。

- 当一个进程关闭之后, 操作系统会回收进程所占用的内存

- 进程之间的内容相互隔离

**我们都知道, CPU 是计算机的核心, 承担所有的计算任务**

**每个进程至少有一个主执行线程, 它无需用户主动创建, 一般由系统自动创建, 主执行线程终止了, 进程也就随之终止**

**进程是 CPU 资源分配的最小单位**

**进程的创建撤销切换开销大, 资源需要重新分配和收回**

进程包括运行中的程序和程序所使用的到的内存和资源

进程是一个内存中运行的应用程序, 每个进程都有一个独立的内存空间, 一个应用程序可以同时运行多个进程(如浏览器); 进程也是程序的一次执行过程, 是系统运行程序的基本单位; 系统运行一个程序即是一个进程从创建, 运行到消亡的过程

CPU 可以有很多进程, 我们的电脑每打开一个软件就会产生一个进程, 或者浏览器每打开一个 Tap 就会产生一个进程(例如 Chrome), 为什么电脑运行的软件多久会很卡, 是因为 CPU 给每个进程分配资源空间, 但是一个 CPU 一共就那么多资源, 分出去越多, 越卡, 每个进程之间是相互独立的, CPU 在运行一个进程时, 其他的进程处于非运行状态, CPU 使用时间片轮转调度来实现同时运行多个进程

###### 进程的状态

进程一共有五种状态: 创建, 就绪, 阻塞, 运行, 终止

1. 就绪态: 就绪状态是指程序已达到可以运行的状态, 只等 CPU 分配资源就可以运行的状态

2. 阻塞态: 当程序运行条件没有满足时, 需要等待条件满足时候才可以执行所处的状态, 如等待 I/O 操作的时候, 此刻的状态就叫阻塞态

3. 运行态: 进程占用 CPU, 并在 CPU 上运行, 即程序正在运行所处的状态

#### 线程

**线程是 CPU 调度的最小单位**

**线程是独立运行和独立调度的基本单位**

线程可以在一个进程中进行切换, 占用资源开销小, 能高效的提高系统多个程序间并发执行的程度

线程是建立在进程的基础上的一次程序运行单位, 通俗点解释就是线程就是程序中的一个执行流, 一个进程可以有一个或多个线程

一个进程中只有一个执行流称作单线程, 即程序执行时, 所走的程序路径按照连续顺序排下来, 前面的必须处理好, 后面的才会执行

一个进程中有多个执行流称作多线程, 即在一个程序中可以同时运行多个不同的线程来执行不同的任务, 也就是说允许单个程序创建多个并行执行的线程来完成各自的任务

线程是进程中的一个执行单元, 负责当前进程中程序的执行, 一个进程中至少有一个线程. 一个进程中是可以有多个线程的, 这个应用程序也称之为多线程程序

###### 引入线程的好处

1. 线程占用资源要比进程少得多
2. 创建一个新的线程花费的代价小
3. 切换线程方便
4. 提高并发性

###### 线程切换

1. CPU 给线程分配时间片, 执行完时间片后会切换到另一个线程
2. 切换之前会保存线程的状态, 下次时间片再给这个线程时才能知道当前状态
3. 从保存线程 A 的状态再到切换到线程 B 时, 重新加载线程 B 的状态的过程叫做上下文切换
4. 上下文切换时会消耗大量的 CPU 时间

###### 线程开销

1. 上下文切换消耗
2. 线程创建和消亡的开销
3. 线程需要保存维持线程本地栈, 会消耗内存

#### 多进程和多线程

###### 多进程

多进程指的是在同一时间里, 同一个计算机系统中如果允许两个或两个以上的进程处于允许状态, 多进程带来的好处是明显的, 比如大家可以在网易云听歌的同时打开编辑器敲代码, 编辑器和网易云的进程之间不会相互干扰

在同一个时间里, 同一个计算机系统如果能够允许两个或两个以上的进程处于运行状态, 这便是多任务, 即多进程, 现代的操作系统几乎都是多进程操作系统, 能够同时管理多个进程的运行

多进程带来的好处是明显的, 但是多进程对于系统的资源要求甚高, 资源浪费也比较严重, 应用多进程的场景最多的是 windows 系统, 例如同时开打运行文件, 每个软件打开相当于运行一个进程

###### 多进程优点

1. 每个进程相互独立, 此进程崩溃不会影响主程序的稳定性
2. 通过增加 CPU, 就可以很容易地扩充性能
3. 进程能直接获取系统的资源, 总体能够达到的性能上限非常大

###### 多线程

在一段完整的代码中, 往往会有需要独立的代码模块, 而这些独立运行的程序片段就叫做 "线程", 利用多个线程编程的概念就叫做多线程处理(多线程编程), 多线程是为了同步完成多项任务, 不是为了提高运行效率, 而是为了提高资源使用效率来提高系统的效率

多线程是在程序在同一时间需要完成多项任务的时候实现的, 多线程的目的仅仅是为了提高资源利用效率, 各个线程执行自己的任务, 这些线程可以 "同时进行", 同时进行并非同一时刻进行, 而是在某一时间段内, 完成所有的任务

###### 多线程缺点

1. 多线程比多进程成本低, 但是性能也更低
2. 一个线程的崩溃可能影响到整个程序的稳定性
3. 线程多了以后, 线程本身的调度也很麻烦, 需要消耗较多的 CPU
4. 无法直接获取系统的资源, 总体能够达到的性能上限有限制
5. 线程之间的同步和加锁比较麻烦

#### 进程和线程的区别及对比

进程是操作系统分配资源的最小单位, 线程是程序运行的最小单位

一个进程由一个或多个线程组成, 线程可以理解为是一个进程中代码的不同执行路线

进程之间相互独立, 但同一进程下的各个线程间共享该进程的内存空间(包括代码段, 数据集, 堆等)和一些进程级的资源(如打开文件信号)

**线程是分配处理机的基本单位, 与系统资源无关, 事实上, 正在处理机上运行的是线程, 并非进程**

**进程将 CPU 资源分配给线程, 即真正在 CPU 上运行的是线程, 进程本身不会负责调度线程, 进程和线程都是 OS 调度的**

**严格上讲应该是线程能够获得 CPU 资源, 进程对 CPU 资源的获取也是体现在线程上的**

#### 同一进程的线程共享哪些资源

1. 堆: 由于堆是在进程空间中开辟出来的, 所以他是理所当然的被共享的, 因此 new 出来的都是共享的(16 位平台上分全局堆和局部堆, 局部堆是独享的)
2. 全局变量: 他是与具体某一函数无关的, 所以也与特性线程无关, 因此也是共享的
3. 局部静态变量: 虽然对于局部变量来说, 他在代码中是 "放" 在某一函数中的, 但是其存放位置和全局变量一样, 存于堆中开辟的 .bss 和 .data 段, 是共享的
4. 文件等公用资源: 这个是共享的, 使用这些公共资源的线程必须同步

#### 线程独享的资源

1. 栈
2. 寄存器
3. 线程 ID
